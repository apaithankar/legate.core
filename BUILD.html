
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Basic build &#8212; legate.core  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/params.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=4ea706d9"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'BUILD';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api/index.html" />
    <link rel="prev" title="Legate" href="README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">
   

<a class="navbar-brand logo" href="https://nv-legate.github.io/legate.core/">
  
  
  
  
  
  
    <p class="title logo__title">legate.core</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="README.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Build instructions
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api/index.html">
                        Python API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://nv-legate.github.io/legate.core/cpp-interface">
                        C++ API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="versions.html">
                        Versions
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/nv-legate/legate.core" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="README.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Build instructions
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api/index.html">
                        Python API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://nv-legate.github.io/legate.core/cpp-interface">
                        C++ API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="versions.html">
                        Versions
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/nv-legate/legate.core" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item"><nav class="sidebar-indices-items">
  <p class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="genindex.html"
             accesskey="I">General Index</a>
        </li>
  </ul>
</nav></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Basic build</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <!--
SPDX-FileCopyrightText: Copyright (c) 2023 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
SPDX-License-Identifier: LicenseRef-NvidiaProprietary

NVIDIA CORPORATION, its affiliates and licensors retain all intellectual
property and proprietary rights in and to this material, related
documentation and any modifications thereto. Any use, reproduction,
disclosure or distribution of this material and related documentation
without an express license agreement from NVIDIA CORPORATION or
its affiliates is strictly prohibited.
-->
<section id="basic-build">
<h1>Basic build<a class="headerlink" href="#basic-build" title="Link to this heading">#</a></h1>
<p>If you are building on a cluster, first check if there are specialized scripts
available for your cluster at
<a class="reference external" href="https://github.com/nv-legate/quickstart">nv-legate/quickstart</a>. Even if your
specific cluster is not covered, you may be able to adapt an existing workflow.</p>
<section id="getting-dependencies-through-conda">
<h2>Getting dependencies through conda<a class="headerlink" href="#getting-dependencies-through-conda" title="Link to this heading">#</a></h2>
<p>The primary method of retrieving dependencies for Legate Core and downstream
libraries is through <a class="reference external" href="https://docs.conda.io/en/latest/">conda</a>. You will need
an installation of conda to follow the instructions below. We suggest using
the <a class="reference external" href="https://github.com/mamba-org/mamba">mamba</a> implementation of the conda
package manager.</p>
<p>Please use the <code class="docutils literal notranslate"><span class="pre">scripts/generate-conda-envs.py</span></code> script to create a conda
environment file listing all the packages that are required to build, run and
test Legate Core and all downstream libraries. For example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./scripts/generate-conda-envs.py<span class="w"> </span>--python<span class="w"> </span><span class="m">3</span>.10<span class="w"> </span>--ctk<span class="w"> </span><span class="m">12</span>.2.2<span class="w"> </span>--os<span class="w"> </span>linux<span class="w"> </span>--ucx
---<span class="w"> </span>generating:<span class="w"> </span>environment-test-linux-py310-cuda-12.2.2-ucx.yaml
</pre></div>
</div>
<p>Run this script with <code class="docutils literal notranslate"><span class="pre">-h</span></code> to see all available configuration options for the
generated environment file (e.g. all the supported Python versions). See the
<a class="reference internal" href="#dependency-listing">Dependencies</a> section for more details.</p>
<p>Once you have this environment file, you can install the required packages by
creating a new conda environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mamba<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>legate<span class="w"> </span>-f<span class="w"> </span>&lt;env-file&gt;.yaml
</pre></div>
</div>
<p>or by updating an existing environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mamba<span class="w"> </span>env<span class="w"> </span>update<span class="w"> </span>-f<span class="w"> </span>&lt;env-file&gt;.yaml
</pre></div>
</div>
</section>
<section id="building-through-install-py">
<h2>Building through install.py<a class="headerlink" href="#building-through-install-py" title="Link to this heading">#</a></h2>
<p>The Legate Core repository comes with a helper <code class="docutils literal notranslate"><span class="pre">install.py</span></code> script in the
top-level directory, that will build the C++ parts of the library and install
the C++ and Python components under the currently active Python environment.</p>
<p>To add GPU support, use the <code class="docutils literal notranslate"><span class="pre">--cuda</span></code> flag:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./install.py<span class="w"> </span>--cuda
</pre></div>
</div>
<p>You can specify the CUDA toolkit directory and the CUDA architecture you want to
target using the <code class="docutils literal notranslate"><span class="pre">--with-cuda</span></code> and <code class="docutils literal notranslate"><span class="pre">--arch</span></code> flags, e.g.:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./install.py<span class="w"> </span>--cuda<span class="w"> </span>--with-cuda<span class="w"> </span>/usr/local/cuda/<span class="w"> </span>--arch<span class="w"> </span>ampere
</pre></div>
</div>
<p>By default the script relies on CMake’s auto-detection for these settings.
CMake will first search the currently active Python/conda environment
for dependencies, then any common system-wide installation directories (e.g.
<code class="docutils literal notranslate"><span class="pre">/usr/lib</span></code>). If a dependency cannot be found but is publicly available in source
form (e.g. OpenBLAS), cmake will fetch and build it automatically. You can
override this search by providing an install location for any dependency
explicitly, using a <code class="docutils literal notranslate"><span class="pre">--with-&lt;dep&gt;</span></code> flag, e.g. <code class="docutils literal notranslate"><span class="pre">--with-nccl</span></code> and
<code class="docutils literal notranslate"><span class="pre">--with-openblas</span></code>.</p>
<p>For multi-node execution Legate can use <a class="reference external" href="https://gasnet.lbl.gov/">GASNet</a> (use
<code class="docutils literal notranslate"><span class="pre">--network</span> <span class="pre">gasnet1</span></code> or <code class="docutils literal notranslate"><span class="pre">--network</span> <span class="pre">gasnetex</span></code>, see <a class="reference internal" href="#gasnet-optional">below</a> for
more details) or <a class="reference external" href="https://openucx.org">UCX</a> (use <code class="docutils literal notranslate"><span class="pre">--network</span> <span class="pre">ucx</span></code>, see
<a class="reference internal" href="#ucx-optional">below</a> for more details).</p>
<p>Compiling with networking support requires MPI.</p>
<p>For example this would be an installation for a
<a class="reference external" href="https://www.nvidia.com/en-us/data-center/dgx-superpod/">DGX SuperPOD</a>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./install.py<span class="w"> </span>--network<span class="w"> </span>gasnet1<span class="w"> </span>--conduit<span class="w"> </span>ibv<span class="w"> </span>--cuda<span class="w"> </span>--arch<span class="w"> </span>ampere
</pre></div>
</div>
<p>Alternatively, here is an install line for the
<a class="reference external" href="https://www.cscs.ch/computers/decommissioned/piz-daint-piz-dora/">Piz-Daint</a>
supercomputer:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./install.py<span class="w"> </span>--network<span class="w"> </span>gasnet1<span class="w"> </span>--conduit<span class="w"> </span>aries<span class="w"> </span>--cuda<span class="w"> </span>--arch<span class="w"> </span>pascal
</pre></div>
</div>
<p>To see all available configuration options, run with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> flag:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./install.py<span class="w"> </span>--help
</pre></div>
</div>
</section>
</section>
<section id="advanced-topics">
<h1>Advanced topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">#</a></h1>
<section id="support-matrix">
<h2>Support matrix<a class="headerlink" href="#support-matrix" title="Link to this heading">#</a></h2>
<p>The following table lists Legate’s minimum supported versions of major dependencies.</p>
<p>“Full support” means that the corresponding versions (and all later ones) are
being tested with some regularity, and are expected to work. Please report any
incompatibility you find against a fully-supported version by opening a bug.</p>
<p>“Best-effort support” means that the corresponding versions are not actively
tested, but Legate should be compatible with them. We will not actively work to
fix any incompatibilities discovered under these versions, but we accept
contributions that fix such incompatibilities.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Dependency</p></th>
<th class="head"><p>Full support (min version)</p></th>
<th class="head"><p>Best-effort support (min version)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPU architecture</p></td>
<td><p>x86-64 (Haswell), aarch64</p></td>
<td><p>ppc64le, older x86-64, Apple Silicon</p></td>
</tr>
<tr class="row-odd"><td><p>OS</p></td>
<td><p>RHEL 8, Ubuntu 20.04, MacOS 12</p></td>
<td><p>other Linux</p></td>
</tr>
<tr class="row-even"><td><p>C++ compiler</p></td>
<td><p>gcc 8, clang 7, nvc++ 19.1</p></td>
<td><p>any compiler with C++17 support</p></td>
</tr>
<tr class="row-odd"><td><p>GPU architecture</p></td>
<td><p>Volta</p></td>
<td><p>Pascal</p></td>
</tr>
<tr class="row-even"><td><p>CUDA toolkit</p></td>
<td><p>11.4</p></td>
<td><p>10.0</p></td>
</tr>
<tr class="row-odd"><td><p>Python</p></td>
<td><p>3.10</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>NumPy</p></td>
<td><p>1.22</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="dependency-listing">
<h2>Dependency listing<a class="headerlink" href="#dependency-listing" title="Link to this heading">#</a></h2>
<p>In this section we comment further on our major dependencies. Please consult an
environment file created by <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code> for a full listing of
dependencies, e.g. building and testing tools, and for exact version
requirements.</p>
<section id="operating-system">
<h3>Operating system<a class="headerlink" href="#operating-system" title="Link to this heading">#</a></h3>
<p>Legate has been tested on Linux and MacOS, although only a few flavors of Linux
such as Ubuntu have been thoroughly tested. There is currently no support for
Windows.</p>
<p>Specify your OS when creating a conda environment file through the <code class="docutils literal notranslate"><span class="pre">--os</span></code> flag
of <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code>.</p>
</section>
<section id="python">
<h3>Python<a class="headerlink" href="#python" title="Link to this heading">#</a></h3>
<p>In terms of Python compatibility, Legate <em>roughly</em> follows the timeline outlined
in <a class="reference external" href="https://numpy.org/neps/nep-0029-deprecation_policy.html">NEP 29</a>.</p>
<p>Specify your desired Python version when creating a conda environment file
through the <code class="docutils literal notranslate"><span class="pre">--python</span></code> flag of <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code>.</p>
</section>
<section id="c-compiler">
<h3>C++ compiler<a class="headerlink" href="#c-compiler" title="Link to this heading">#</a></h3>
<p>We suggest that you avoid using the compiler packages available on conda-forge.
These compilers are configured with the specific goal of building
redistributable conda packages (e.g. they explicitly avoid linking to system
directories), which tends to cause issues for development builds. Instead prefer
the compilers available from your distribution’s package manager (e.g. apt/yum)
or your HPC vendor.</p>
<p>If you want to pull the compilers from conda, use an environment file created
by <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code> using the <code class="docutils literal notranslate"><span class="pre">--compilers</span></code> flag. An appropriate
compiler for the target OS will be chosen automatically.</p>
</section>
<section id="cuda-optional">
<h3>CUDA (optional)<a class="headerlink" href="#cuda-optional" title="Link to this heading">#</a></h3>
<p>Only necessary if you wish to run with Nvidia GPUs.</p>
<p>Some CUDA components necessary for building, e.g. the <code class="docutils literal notranslate"><span class="pre">nvcc</span></code> compiler and driver
stubs, are not distributed through conda. These must instead be installed using
<a class="reference external" href="https://developer.nvidia.com/cuda-downloads">system-level packages</a>. If these
are not installed under a standard system location, you will need to inform
<code class="docutils literal notranslate"><span class="pre">install.py</span></code> of their location using <code class="docutils literal notranslate"><span class="pre">--with-cuda</span></code>.</p>
<p>If you intend to pull any CUDA libraries from conda (see below), conda will need
to install an environment-local copy of the CUDA toolkit, even if you have it
installed system-wide. To avoid versioning conflicts it is safest to match the
version of CUDA installed system-wide, by specifying it to
<code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code> through the <code class="docutils literal notranslate"><span class="pre">--ctk</span></code> flag.</p>
<p>Legate is tested and guaranteed to be compatible with Volta and later GPU
architectures. You can use Legate with Pascal GPUs as well, but there could
be issues due to lack of independent thread scheduling. Please report any such
issues on GitHub.</p>
</section>
<section id="cuda-libraries-optional">
<h3>CUDA libraries (optional)<a class="headerlink" href="#cuda-libraries-optional" title="Link to this heading">#</a></h3>
<p>Only necessary if you wish to run with Nvidia GPUs.</p>
<p>The following additional CUDA libraries are required, for use by legate.core or
downstream libraries. Unless noted otherwise, these are included in the conda
environment file.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cublas</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cufft</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">curand</span></code> (can optionally be used for its host fallback implementations even
when building without CUDA support)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cusolver</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cutensor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nccl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvtx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thrust</span></code> (pulled from github)</p></li>
</ul>
<p>If you wish to provide alternative installations for these, then you can remove
them from the environment file (or invoke <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code> with <code class="docutils literal notranslate"><span class="pre">--ctk</span> <span class="pre">none</span></code>, which will skip them all), and pass the corresponding <code class="docutils literal notranslate"><span class="pre">--with-&lt;dep&gt;</span></code> flag
to <code class="docutils literal notranslate"><span class="pre">install.py</span></code> (or let the build process attempt to locate them automatically).</p>
</section>
<section id="openblas">
<h3>OpenBLAS<a class="headerlink" href="#openblas" title="Link to this heading">#</a></h3>
<p>Used by cuNumeric for implementing linear algebra routines on CPUs.</p>
<p>This library is automatically pulled from conda. If you wish to provide an
alternative installation, then you can manually remove <code class="docutils literal notranslate"><span class="pre">openblas</span></code> from the
generated environment file and pass <code class="docutils literal notranslate"><span class="pre">--with-openblas</span></code> to cuNumeric’s
<code class="docutils literal notranslate"><span class="pre">install.py</span></code>.</p>
<p>Note that if you want to build OpenBLAS from source you will need to get a
Fortran compiler, e.g. by pulling <code class="docutils literal notranslate"><span class="pre">fortran-compiler</span></code> from conda-forge.</p>
<p>If you wish to compile Legate with OpenMP support, then you need a build of
OpenBLAS configured with the following options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">USE_THREAD=1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_OPENMP=1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NUM_PARALLEL=32</span></code> (or at least as many as the NUMA domains on the target
machine) – The <code class="docutils literal notranslate"><span class="pre">NUM_PARALLEL</span></code> flag defines how many instances of OpenBLAS’s
calculation API can run in parallel. Legate will typically instantiate a
separate OpenMP group per NUMA domain, and each group can launch independent
BLAS work. If <code class="docutils literal notranslate"><span class="pre">NUM_PARALLEL</span></code> is not high enough, some of this parallel work
will be serialized.</p></li>
</ul>
</section>
<section id="tblis">
<h3>TBLIS<a class="headerlink" href="#tblis" title="Link to this heading">#</a></h3>
<p>Used by cuNumeric for implementing tensor contraction routines on CPUs.</p>
<p>This library will be automatically downloaded and built during cuNumeric
installation. If you wish to provide an alternative installation, pass
<code class="docutils literal notranslate"><span class="pre">--with-tblis</span></code> to cuNumeric’s <code class="docutils literal notranslate"><span class="pre">install.py</span></code>.</p>
<p>cuNumeric requires a build of TBLIS configured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">label</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">int32_t</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">length</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">int64_t</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">stride</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">int64_t</span>
</pre></div>
</div>
<p>and additionally <code class="docutils literal notranslate"><span class="pre">--enable-thread-model=openmp</span></code> if cuNumeric is compiled
with OpenMP support.</p>
</section>
<section id="numactl-optional">
<h3>Numactl (optional)<a class="headerlink" href="#numactl-optional" title="Link to this heading">#</a></h3>
<p>Required to support CPU and memory binding in the Legate launcher.</p>
<p>Not available on conda; typically available through the system-level package
manager.</p>
</section>
<section id="mpi-optional">
<h3>MPI (optional)<a class="headerlink" href="#mpi-optional" title="Link to this heading">#</a></h3>
<p>Only necessary if you wish to run on multiple nodes.</p>
<p>We suggest that you avoid using the generic build of OpenMPI available on
conda-forge. Instead prefer an MPI installation provided by your HPC vendor, or
from system-wide distribution channels like apt/yum and
<a class="reference external" href="https://network.nvidia.com/products/infiniband-drivers/linux/mlnx_ofed/">MOFED</a>,
since these will likely be more compatible with (and tuned for) your particular
system.</p>
<p>If you want to use the OpenMPI distributed on conda-forge, use an environment
file created by <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code> using the <code class="docutils literal notranslate"><span class="pre">--openmpi</span></code> flag.</p>
<p>Legate requires a build of MPI that supports <code class="docutils literal notranslate"><span class="pre">MPI_THREAD_MULTIPLE</span></code>.</p>
</section>
<section id="rdma-networking-libraries-e-g-infiniband-roce-slingshot-optional">
<h3>RDMA/networking libraries (e.g. Infiniband, RoCE, Slingshot)  (optional)<a class="headerlink" href="#rdma-networking-libraries-e-g-infiniband-roce-slingshot-optional" title="Link to this heading">#</a></h3>
<p>Only necessary if you wish to run on multiple nodes, using the corresponding
networking hardware.</p>
<p>Not available on conda; typically available through MOFED or the system-level
package manager.</p>
<p>Depending on your hardware, you may need to use a particular Realm
networking backend, e.g. as of October 2023 HPE Slingshot is only
compatible with GASNet.</p>
</section>
<section id="gasnet-optional">
<h3>GASNet (optional)<a class="headerlink" href="#gasnet-optional" title="Link to this heading">#</a></h3>
<p>Only necessary if you wish to run on multiple nodes, using the GASNet1 or
GASNetEx Realm networking backend.</p>
<p>This library will be automatically downloaded and built during Legate
installation. If you wish to provide an alternative installation, pass
<code class="docutils literal notranslate"><span class="pre">--with-gasnet</span></code> to <code class="docutils literal notranslate"><span class="pre">install.py</span></code>.</p>
<p>When using GASNet, you also need to specify the interconnect network of the
target machine using the <code class="docutils literal notranslate"><span class="pre">--conduit</span></code> flag.</p>
</section>
<section id="ucx-optional">
<h3>UCX (optional)<a class="headerlink" href="#ucx-optional" title="Link to this heading">#</a></h3>
<p>Only necessary if you wish to run on multiple nodes, using the UCX Realm
networking backend.</p>
<p>You can use the version of UCX available on conda-forge by using an environment
file created by <code class="docutils literal notranslate"><span class="pre">generate-conda-envs.py</span></code> using the <code class="docutils literal notranslate"><span class="pre">--ucx</span></code> flag. Note that this
build of UCX might not include support for the particular networking hardware on
your machine (or may not be optimally tuned for such). In that case you may want
to use an environment file generated with <code class="docutils literal notranslate"><span class="pre">--no-ucx</span></code> (default), get UCX from
another source (e.g. MOFED, the system-level package manager, or compiled
manually from <a class="reference external" href="https://github.com/openucx/ucx">source</a>), and pass the location
of your UCX installation to <code class="docutils literal notranslate"><span class="pre">install.py</span></code> (if necessary) using <code class="docutils literal notranslate"><span class="pre">--with-ucx</span></code>.</p>
<p>Legate requires a build of UCX configured with <code class="docutils literal notranslate"><span class="pre">--enable-mt</span></code>.</p>
</section>
</section>
<section id="alternative-sources-for-dependencies">
<h2>Alternative sources for dependencies<a class="headerlink" href="#alternative-sources-for-dependencies" title="Link to this heading">#</a></h2>
<p>If you do not wish to use conda for some (or all) of the dependencies, you can
remove the corresponding entries from the environment file before passing it to
conda. See <a class="reference internal" href="#building-through-install-py">the <code class="docutils literal notranslate"><span class="pre">install.py</span></code> section</a> for
instructions on how to provide alternative locations for these dependencies to
the build process.</p>
<p>Note that this is likely to result in conflicts between conda-provided and
system-provided libraries.</p>
<p>Conda distributes its own version of certain common libraries (in particular the
C++ standard library), which are also typically available system-wide. Any
system package you include will typically link to the system version, while
conda packages link to the conda version. Often these two different versions,
although incompatible, carry the same version number (<code class="docutils literal notranslate"><span class="pre">SONAME</span></code>), and are
therefore indistinguishable to the dynamic linker. Then, the first component to
specify a link location for this library will cause it to be loaded from there,
and any subsequent link requests for the same library, even if suggesting a
different link location, will get served using the previously linked version.</p>
<p>This can cause link failures at runtime, e.g. when a system-level library
happens to be the first to load GLIBC, causing any conda library that comes
after to trip GLIBC’s internal version checks, since the conda library expects
to find symbols with more recent version numbers than what is available on the
system-wide GLIBC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.30&#39; not found (required by /opt/conda/envs/legate/lib/libarrow.so)
</pre></div>
</div>
<p>You can usually work around this issue by putting the conda library directory
first in the dynamic library resolution path:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$CONDA_PREFIX</span><span class="s2">/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>This way you can make sure that the (typically more recent) conda version of any
common library will be preferred over the system-wide one, no matter which
component requests it first.</p>
</section>
<section id="building-through-pip">
<h2>Building through pip<a class="headerlink" href="#building-through-pip" title="Link to this heading">#</a></h2>
<p>Legate Core is not yet registered in a standard pip repository. However, users
can still use the pip installer to build and install Legate Core. The following
command will trigger a single-node, CPU-only build of Legate Core, then install
it into the currently active Python environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>or</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>Legate relies on CMake to select its toolchain and build flags. Users can set
the environment variables <code class="docutils literal notranslate"><span class="pre">CXX</span></code> or <code class="docutils literal notranslate"><span class="pre">CXXFLAGS</span></code> prior to building to override the
CMake defaults.</p>
<p>Alternatively, CMake and build tool arguments can be passed via the
<code class="docutils literal notranslate"><span class="pre">CMAKE_ARGS</span></code>/<code class="docutils literal notranslate"><span class="pre">SKBUILD_CONFIGURE_OPTIONS</span></code> and <code class="docutils literal notranslate"><span class="pre">SKBUILD_BUILD_OPTIONS</span></code>
<a class="reference external" href="https://scikit-build.readthedocs.io/en/latest/usage.html#environment-variable-configuration">environment variables</a>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">CMAKE_ARGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMAKE_ARGS</span><span class="k">:-</span><span class="si">}</span><span class="s2"> -D Legion_USE_CUDA:BOOL=ON&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>pip<span class="w"> </span>install<span class="w"> </span>.
</pre></div>
</div>
<p>An alternative syntax using <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> with <code class="docutils literal notranslate"><span class="pre">scikit-build</span></code> is</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>setup.py<span class="w"> </span>install<span class="w"> </span>--<span class="w"> </span>-DLegion_USE_CUDA:BOOL<span class="o">=</span>ON
</pre></div>
</div>
</section>
<section id="building-through-pip-cmake">
<h2>Building through pip &amp; cmake<a class="headerlink" href="#building-through-pip-cmake" title="Link to this heading">#</a></h2>
<p>pip uses <a class="reference external" href="https://scikit-build.readthedocs.io/en/latest/">scikit-build</a>
in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> to drive the build and installation.  A <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> will trigger three general actions:</p>
<ol class="arabic simple">
<li><p>CMake build and installation of C++ libraries</p></li>
<li><p>CMake generation of configuration files and build-dependent Python files</p></li>
<li><p>pip installation of Python files</p></li>
</ol>
<p>The CMake build can be configured independently of <code class="docutils literal notranslate"><span class="pre">pip</span></code>, allowing incremental C++ builds directly through CMake.
This simplifies rebuilding the C++ shared libraries either via command-line or via IDE.
After building the C++ libraries, the <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> can be done in “editable” mode using the <code class="docutils literal notranslate"><span class="pre">-e</span></code> flag.
This configures the Python site packages to import the Python source tree directly.
The Python source can then be edited and used directly for testing without requiring another <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>.</p>
<p>There are several examples in the <code class="docutils literal notranslate"><span class="pre">scripts</span></code> folder. We walk through the steps in
<code class="docutils literal notranslate"><span class="pre">build-separately-no-install.sh</span></code> here.</p>
<p>First, the CMake build needs to be configured:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cmake<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-GNinja<span class="w"> </span>-D<span class="w"> </span><span class="nv">Legion_USE_CUDA</span><span class="o">=</span>ON
</pre></div>
</div>
<p>Once configured, we can build the C++ libraries:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span>build
</pre></div>
</div>
<p>This will invoke Ninja (or make) to execute the build.
Once the C++ libraries are available, we can do an editable (development) pip installation.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">SKBUILD_BUILD_OPTIONS</span><span class="o">=</span><span class="s2">&quot;-D FIND_LEGATE_CORE_CPP=ON -D legate_core_ROOT=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/build&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--root<span class="w"> </span>/<span class="w"> </span>--no-deps<span class="w"> </span>--no-build-isolation
<span class="w">  </span>--editable<span class="w"> </span>.
</pre></div>
</div>
<p>The Python source tree and CMake build tree are now available with the environment Python
for running Legate programs. The diagram below illustrates the
complete workflow for building both Legate core and a downstream package,
<a class="reference external" href="https://github.com/nv-legate/cunumeric">cuNumeric</a></p>
<img src="docs/figures/developer-build.png" alt="drawing" width="600"/>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Legate</p>
      </div>
    </a>
    <a class="right-next"
       href="api/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Basic build</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-dependencies-through-conda">Getting dependencies through conda</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-through-install-py">Building through install.py</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-topics">Advanced topics</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#support-matrix">Support matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-listing">Dependency listing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#operating-system">Operating system</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python">Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#c-compiler">C++ compiler</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-optional">CUDA (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cuda-libraries-optional">CUDA libraries (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openblas">OpenBLAS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tblis">TBLIS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numactl-optional">Numactl (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mpi-optional">MPI (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rdma-networking-libraries-e-g-infiniband-roce-slingshot-optional">RDMA/networking libraries (e.g. Infiniband, RoCE, Slingshot)  (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gasnet-optional">GASNet (optional)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ucx-optional">UCX (optional)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-sources-for-dependencies">Alternative sources for dependencies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-through-pip">Building through pip</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-through-pip-cmake">Building through pip &amp; cmake</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2021-2023, NVIDIA.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>