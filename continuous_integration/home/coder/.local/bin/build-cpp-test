#!/usr/bin/env bash

build_cpp_tests() {
    set -ex;

    conda deactivate

    cd ~/legate/tests/cpp

    rm -rf build
    cmake --preset ${LEGATE_CORE_CMAKE_PRESET}
    cmake --build --preset ${LEGATE_CORE_CMAKE_PRESET}

    (
    cd ./build/${LEGATE_CORE_CMAKE_PRESET};
    cpack -G TGZ;
    cp cpp_tests*.tar.gz /tmp/out/;
    );

    { set +x; } 2>/dev/null;
}

build_cpp_tests "$@";
