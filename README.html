

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Legate &#8212; legate.core  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/params.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'README';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic build" href="BUILD.html" />
    <link rel="prev" title="Welcome to Legate Core’s documentation!" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    <p class="title logo__title">legate.core  documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="BUILD.html">
                        Build instructions
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api/index.html">
                        Python API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://nv-legate.github.io/legate.core/cpp-interface">
                        C++ API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="CONTRIBUTING.html">
                        Contributing
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="versions.html">
                        Versions
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="BUILD.html">
                        Build instructions
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api/index.html">
                        Python API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://nv-legate.github.io/legate.core/cpp-interface">
                        C++ API Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="CONTRIBUTING.html">
                        Contributing
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="versions.html">
                        Versions
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Legate</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <!--
Copyright 2021-2022 NVIDIA Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->
<section id="legate">
<h1>Legate<a class="headerlink" href="#legate" title="Permalink to this heading">#</a></h1>
<p>The Legate project endeavors to democratize computing by making it possible
for all programmers to leverage the power of large clusters of CPUs and GPUs
by running the same code that runs on a desktop or a laptop at scale.
Using this technology, computational and data scientists can develop and test
programs on moderately sized data sets on local machines and then immediately
scale up to larger data sets deployed on many nodes in the cloud or on a
supercomputer without any code modifications. In visual terms:</p>
<img src="docs/figures/vision.png" alt="drawing" width="700"/>
<p>The Legate project is built upon two foundational principles:</p>
<ol class="arabic simple">
<li><p>For end users, such as computational and data scientists, the programming
model must be identical to programming a single sequential CPU on their
laptop or desktop. All concerns relating to parallelism, data
distribution, and synchronization must be implicit. The cloud or a
supercomputer should appear as nothing more than a super-powerful CPU core.</p></li>
<li><p>Software must be compositional and not just interoperable (i.e. functionally
correct). Libraries developed in the Legate ecosystem must be able to exchange
partitioned and distributed data without requiring “shuffles” or unnecessary
blocking synchronization. Computations from different libraries should be
able to use arbitrary data and still be reordered across abstraction boundaries
to hide communication and synchronization latencies where the original sequential
semantics of the program allow. This is essential for achieving speed-of-light
performance on large scale machines.</p></li>
</ol>
<p>The Legate project is still in its nascent stages of development, but much of
the fundamental architecture is in place. We encourage development and contributions
to existing Legate libraries, as well as the development of new Legate libraries.
Pull requests are welcomed.</p>
<p>If you have questions, please contact us at legate(at)nvidia.com.</p>
<ul class="simple">
<li><p><span class="xref myst">Legate</span></p>
<ul>
<li><p><span class="xref myst">Why Legate?</span></p></li>
<li><p><span class="xref myst">What is the Legate Core?</span></p></li>
<li><p><span class="xref myst">How Does Legate Work?</span></p></li>
<li><p><span class="xref myst">How Do I Install Legate?</span></p></li>
<li><p><span class="xref myst">How Do I Use Legate?</span></p>
<ul>
<li><p><span class="xref myst">Distributed Launch</span></p></li>
<li><p><span class="xref myst">Debugging and Profiling</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">Running Legate programs with Jupyter Notebook</span></p>
<ul>
<li><p><span class="xref myst">Installation of the Legate IPython Kernel</span></p></li>
<li><p><span class="xref myst">Running with Jupyter Notebook</span></p></li>
<li><p><span class="xref myst">Configuring the Jupyter Notebook</span></p></li>
<li><p><span class="xref myst">Magic Command</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">Other FAQs</span></p></li>
<li><p><span class="xref myst">Contributing</span></p></li>
<li><p><span class="xref myst">Documentation</span></p></li>
<li><p><span class="xref myst">Next Steps</span></p></li>
</ul>
</li>
</ul>
<section id="why-legate">
<h2>Why Legate?<a class="headerlink" href="#why-legate" title="Permalink to this heading">#</a></h2>
<p>Computational problems today continue to grow both in their complexity as well
as the scale of the data that they consume and generate. This is true both in
traditional HPC domains as well as enterprise data analytics cases. Consequently,
more and more users truly need the power of large clusters of both CPUs and
GPUs to address their computational problems. Not everyone has the time or
resources required to learn and deploy the advanced programming models and tools
needed to target this class of hardware today. Legate aims to bridge this gap
so that any programmer can run code on any scale machine without needing to be
an expert in parallel programming and distributed systems, thereby allowing
developers to bring the problem-solving power of large machines to bear on
more kinds of challenging problems than ever before.</p>
</section>
<section id="what-is-the-legate-core">
<h2>What is the Legate Core?<a class="headerlink" href="#what-is-the-legate-core" title="Permalink to this heading">#</a></h2>
<p>The Legate Core is our version of <a class="reference external" href="https://arrow.apache.org/">Apache Arrow</a>. Apache
Arrow has significantly improved composability of software libraries by making it
possible for different libraries to share in-memory buffers of data without
unnecessary copying. However, it falls short when it comes to meeting two
of our primary requirements for Legate:</p>
<ol class="arabic simple">
<li><p>Arrow only provides an API for describing a physical representation
of data as a single memory allocation. There is no interface for describing
cases where data has been partitioned and then capturing the logical
relationships of those partitioned subsets of data.</p></li>
<li><p>Arrow is mute on the subject of synchronization. Accelerators such as GPUs
achieve significantly higher performance when computations are performed
asynchronously with respect to other components of the system. When data is
passed between libraries today, accelerators must be pessimistically
synchronized to ensure that data dependences are satisfied across abstraction
boundaries. This might result in tolerable overheads for single GPU systems,
but can result in catastrophically poor performance when hundreds of GPUs are involved.</p></li>
</ol>
<p>The Legate Core provides an API very similar to Arrow’s interface with several
important distinctions that provide stronger guarantees about data coherence and
synchronization to aid library developers when building Legate libraries. These
guarantees are the crux of how libraries in the Legate ecosystem are able to
provide excellent composability.</p>
<p>The Legate Core API imports several important concepts from Arrow such that
users that are familiar with Arrow already will find it unsurprising. We use
the same type system representation as Arrow so libraries that have already
adopted it do not need to learn or adapt to a new type system. We also reuse
the concept of an <a class="reference external" href="https://arrow.apache.org/docs/cpp/api/array.html">Array</a>
from Arrow. The <code class="docutils literal notranslate"><span class="pre">LegateArray</span></code> class supports many of the same methods as
the Arrow Array interface (we’ll continue to add methods to improve
compatibility). The main difference is that instead of obtaining
<a class="reference external" href="https://arrow.apache.org/docs/cpp/api/memory.html#_CPPv4N5arrow6Buffer">Buffer</a>
objects from arrays to describe allocations of data that back the array, the
Legate Core API introduces a new primitive called a <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> which
provides a new interface for reasoning about partitioned and distributed
data in asynchronous execution environments.</p>
<p>Any implementation of a <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> must maintain the following guarantees
to clients of the Legate Core API (i.e. Legate library developers):</p>
<ol class="arabic simple">
<li><p>The coherence of data contained in a <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> must be implicitly
managed by the implementation of the Legate Core API. This means that
no matter where data is requested to perform a computation in a machine,
the most recent modifications to that data in program order must be
reflected. It should never be clients responsibility to maintain this
coherence.</p></li>
<li><p>It should be possible to create arbitrary views onto <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> objects
such that library developers can precisely describe the working sets of
their computations. Modifications to views must be reflected onto all
aliasing views data. This property must be maintained by the Legate Core
API implementation such that it is never the concern of clients.</p></li>
<li><p>Dependence management between uses of the <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> objects and their
views is the responsibility of Legate Core API regardless of what
(asynchronous) computations are performed on <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> objects or their
views. This dependence analysis must be both sound and precise. It is
illegal to over-approximate dependences. This dependence analysis must also
be performed globally in scope. Any use of the <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> on any
processor/node in the system must abide by the original sequential
semantics of the program</p></li>
</ol>
<p>Note that we do not specify exactly what the abstractions are that are needed
for implementing <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> objects. Our goal is not prescribe what these
abstractions are as they may be implementation dependent. Our only requirements
are that they have these properties to ensure that incentives are aligned in
such a way for Legate libraries to achieve a high degree of composability
at any scale of machine. Indeed, these requirements shift many of the burdens
that make implementing distributed and accelerated libraries hard off of the
library developers and onto the implementation of the Legate Core API. This
is by design as it allows the costs to be amortized across all libraries in
the ecosystem and ensures that Legate library developers are more productive.</p>
</section>
<section id="how-does-legate-work">
<h2>How Does Legate Work?<a class="headerlink" href="#how-does-legate-work" title="Permalink to this heading">#</a></h2>
<p>Our implementation of the Legate Core API is built on top of the
<a class="reference external" href="http://legion.stanford.edu">Legion</a> programming model and runtime system.
Legion was originally designed for large HPC applications that target
supercomputers and consequently applications written in the Legion programming
model tend to both perform and scale well on large clusters of both CPUs and
GPUs. Legion programs are also easy to port to new machines as they inherently
decouple the machine-independent specification of computations from decisions
about how that application is mapped to the target machine. Due to this
abstract nature, many programmers find writing Legion programs challenging.
By implementing the Legate Core API on top of Legion, we’ve made it easier
to use Legion such that developers can still get access to the benefits of
Legion without needing to learn all of the lowest-level interfaces.</p>
<p>The <a class="reference external" href="https://legion.stanford.edu/pdfs/sc2012.pdf">Legion programming model</a>
greatly aids in implementing the Legate Core API. Data types from libraries,
such as arrays in cuNumeric are mapped down onto <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> objects
that wrap Legion data types such as logical regions or futures.
In the case of regions, Legate application libraries rely heavily on
Legion’s <a class="reference external" href="https://legion.stanford.edu/pdfs/oopsla2013.pdf">support for partitioning of logical regions into arbitrary
subregion views</a>.
Each library has its own heuristics for computing such partitions that
take into consideration the computations that will access the data, the
ideal sizes of data to be consumed by different processor kinds, and
the available number of processors. Legion automatically manages the coherence
of subregion views regardless of the scale of the machine.</p>
<p>Computations in Legate application libraries are described by Legion tasks.
Tasks describe their data usage in terms of <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code> objects, thereby
allowing Legion to infer where dependences exist. Legion uses distributed
bounding volume hierarchies, similar to a high performance ray-tracer,
to soundly and precisely perform dependence analysis on logical regions
and insert the necessary synchronization between tasks to maintain the
original sequential semantics of a Legate program.</p>
<p>Each Legate application library also comes with its own custom Legion
mapper that uses heuristics to determine the best choice of mapping for
tasks (e.g. are they best run on a CPU or a GPU). All
Legate tasks are currently implemented in native C or CUDA in order to
achieve excellent performance on the target processor kind, but Legion
has bindings in other languages such as Python, Fortran, and Lua for
users that would prefer to use them. Importantly, by using Legion,
Legate is able to control the placement of data in order to leave it
in-place in fast memories like GPU framebuffers across tasks.</p>
<p>When running on large clusters, Legate leverages a novel technology provided
by Legion called “<a class="reference external" href="https://research.nvidia.com/sites/default/files/pubs/2021-02_Scaling-Implicit-Parallelism//ppopp.pdf">control replication</a>” to avoid the sequential bottleneck
of having one node farm out work to all the nodes in the cluster. With
control replication, Legate will actually replicate the Legate program and
run it across all the nodes of the machine at the same time. These copies
of the program all cooperate logically to appear to execute as one
program. When communication is necessary between
different computations, the Legion runtime’s program analysis will automatically
detect it and insert the necessary data movement and synchronization
across nodes (or GPU framebuffers). This is the transformation that allows
sequential programs to run efficiently at scale across large clusters
as though they are running on a single processor.</p>
</section>
<section id="how-do-i-install-legate">
<h2>How Do I Install Legate?<a class="headerlink" href="#how-do-i-install-legate" title="Permalink to this heading">#</a></h2>
<p>Legate Core is available <a class="reference external" href="https://anaconda.org/legate/legate-core">on conda</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">nvidia</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="o">-</span><span class="n">c</span> <span class="n">legate</span> <span class="n">legate</span><span class="o">-</span><span class="n">core</span>
</pre></div>
</div>
<p>Only linux-64 packages are available at the moment.</p>
<p>The default package contains GPU support, and is compatible with CUDA &gt;= 11.4
(CUDA driver version &gt;= r470), and Volta or later GPU architectures. There are
also CPU-only packages available, and will be automatically selected by <code class="docutils literal notranslate"><span class="pre">conda</span></code>
when installing on a machine without GPUs.</p>
<p>See <a class="reference internal" href="BUILD.html"><span class="doc std std-doc">BUILD.md</span></a> for instructions on building Legate Core from source.</p>
</section>
<section id="how-do-i-use-legate">
<h2>How Do I Use Legate?<a class="headerlink" href="#how-do-i-use-legate" title="Permalink to this heading">#</a></h2>
<p>After installing the Legate Core library, the next step is to install a Legate
application library such as cuNumeric. The installation process for a
Legate application library will require you to provide a pointer to the location
of your Legate Core library installation as this will be used to configure the
installation of the Legate application library. After you finish installing any
Legate application libraries, you can then simply replace their <code class="docutils literal notranslate"><span class="pre">import</span></code> statements
with the equivalent ones from any Legate application libraries you have installed.
For example, you can change this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>to this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cunumeric</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>After this, you can use the <code class="docutils literal notranslate"><span class="pre">legate</span></code> driver script in the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory of
your installation to run any Python program. <strong>Note that the default python
interpreter (<code class="docutils literal notranslate"><span class="pre">python</span></code>) will not work with programs that use Legate libraries, you
need to use this custom driver script.</strong></p>
<p>For example, to run your script in the default configuration (4 CPUs cores and
4 GB of memory) just run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ legate my_python_program.py [other args]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">legate</span></code> script also allows you to control the amount of resources that
Legate consumes when running on the machine. The <code class="docutils literal notranslate"><span class="pre">--cpus</span></code> and <code class="docutils literal notranslate"><span class="pre">--gpus</span></code> flags
are used to specify how many CPU and GPU processors should be used on a node.
The <code class="docutils literal notranslate"><span class="pre">--sysmem</span></code> flag can be used to specify how many MBs of DRAM Legate is allowed
to use per node, while the <code class="docutils literal notranslate"><span class="pre">--fbmem</span></code> flag controls how many MBs of framebuffer
memory Legate is allowed to use per GPU. For example, when running on a DGX
station, you might run your application as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ legate --cpus 16 --gpus 4 --sysmem 100000 --fbmem 15000 my_python_program.py
</pre></div>
</div>
<p>This will make 16 CPU processors and all 4 GPUs available for use by Legate.
It will also allow Legate to consume up to 100 GB of DRAM memory and 15 GB of
framebuffer memory per GPU for a total of 60 GB of GPU framebuffer memory. Note
that you probably will not be able to make all the resources of the machine
available for Legate as some will be used by the system or Legate itself for
meta-work. Currently if you try to exceed these resources during execution then
Legate will inform you that it had insufficient resources to complete the job
given its current mapping heuristics. If you believe the job should fit within
the assigned resources please let us know so we can improve our mapping heuristics.
There are many other flags available for use in the <code class="docutils literal notranslate"><span class="pre">legate</span></code> driver script that you
can use to communicate how Legate should view the available machine resources.
You can see a list of them by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ legate --help
</pre></div>
</div>
<p>In addition to running Legate programs, you can also use Legate in an interactive
mode by simply not passing any <code class="docutils literal notranslate"><span class="pre">*py</span></code> files on the command line. You can still
request resources just as you would though with a normal file. Legate will
still use all the resources available to it, including doing multi-node execution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ legate --cpus 16 --gpus 4 --sysmem 100000 --fbmem 15000
Welcome to Legion Python interactive console
&gt;&gt;&gt;
</pre></div>
</div>
<p>Note that Legate does not currently support multi-tenancy cases where different
users are attempting to use the same hardware concurrently.</p>
<p>As a convenience, several command-line options can have their default values set
via environment variables. These environment variables, their corresponding command-
line options, and their default values are as follows.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>CLI Option</p></th>
<th class="head"><p>Env. Variable</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>–omps</p></td>
<td><p>LEGATE_OMP_PROCS</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>–ompthreads</p></td>
<td><p>LEGATE_OMP_THREADS</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>–utility</p></td>
<td><p>LEGATE_UTILITY_CORES</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>–sysmem</p></td>
<td><p>LEGATE_SYSMEM</p></td>
<td><p>4000</p></td>
</tr>
<tr class="row-even"><td><p>–numamem</p></td>
<td><p>LEGATE_NUMAMEM</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>–fbmem</p></td>
<td><p>LEGATE_FBMEM</p></td>
<td><p>4000</p></td>
</tr>
<tr class="row-even"><td><p>–zcmem</p></td>
<td><p>LEGATE_ZCMEM</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>–regmem</p></td>
<td><p>LEGATE_REGMEM</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>–eager-alloc-percentage</p></td>
<td><p>LEGATE_EAGER_ALLOC_PERCENTAGE</p></td>
<td><p>50</p></td>
</tr>
</tbody>
</table>
<section id="distributed-launch">
<h3>Distributed Launch<a class="headerlink" href="#distributed-launch" title="Permalink to this heading">#</a></h3>
<p>If Legate is compiled with networking support (see the
<span class="xref myst">installation section</span>),
it can be run in parallel by using the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> option followed by the number of nodes
to be used.  Whenever the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> option is used, Legate will be launched
using <code class="docutils literal notranslate"><span class="pre">mpirun</span></code>, even with <code class="docutils literal notranslate"><span class="pre">--nodes</span> <span class="pre">1</span></code>.  Without the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> option, no launcher will
be used.  Legate currently supports <code class="docutils literal notranslate"><span class="pre">mpirun</span></code>, <code class="docutils literal notranslate"><span class="pre">srun</span></code>, and <code class="docutils literal notranslate"><span class="pre">jsrun</span></code> as launchers and we
are open to adding additional launcher kinds. You can select the
target kind of launcher with <code class="docutils literal notranslate"><span class="pre">--launcher</span></code>.</p>
</section>
<section id="debugging-and-profiling">
<h3>Debugging and Profiling<a class="headerlink" href="#debugging-and-profiling" title="Permalink to this heading">#</a></h3>
<p>Legate also comes with several tools that you can use to better understand
your program both from a correctness and a performance standpoint. For
correctness, Legate has facilities for constructing both dataflow
and event graphs for the actual run of an application. These graphs require
that you have an installation of <a class="reference external" href="https://www.graphviz.org/">GraphViz</a>
available on your machine. To generate a dataflow graph for your Legate
program simply pass the <code class="docutils literal notranslate"><span class="pre">--dataflow</span></code> flag to the <code class="docutils literal notranslate"><span class="pre">legate.py</span></code> script and after
your run is complete we will generate a <code class="docutils literal notranslate"><span class="pre">dataflow_legate.pdf</span></code> file containing
the dataflow graph of your program. To generate a corresponding event graph
you simply need to pass the <code class="docutils literal notranslate"><span class="pre">--event</span></code> flag to the <code class="docutils literal notranslate"><span class="pre">legate.py</span></code> script to generate
a <code class="docutils literal notranslate"><span class="pre">event_graph_legate.pdf</span></code> file. These files can grow to be fairly large for non-trivial
programs so we encourage you to keep your programs small when using these
visualizations or invest in a <a class="reference external" href="https://get.adobe.com/reader/">robust PDF viewer</a>.</p>
<p>For profiling all you need to do is pass the <code class="docutils literal notranslate"><span class="pre">--profile</span></code> flag to Legate and
afterwards you will have a <code class="docutils literal notranslate"><span class="pre">legate_prof</span></code> directory containing a web page that
can be viewed in any web browser that displays a timeline of your program’s
execution. You simply need to load the <code class="docutils literal notranslate"><span class="pre">index.html</span></code> page from a browser. You
may have to enable local JavaScript execution if you are viewing the page from
your local machine (depending on your browser).</p>
<p>We recommend that you do not mix debugging and profiling in the same run as
some of the logging for the debugging features requires significant file I/O
that can adversely effect the performance of the application.</p>
</section>
</section>
<section id="running-legate-programs-with-jupyter-notebook">
<h2>Running Legate programs with Jupyter Notebook<a class="headerlink" href="#running-legate-programs-with-jupyter-notebook" title="Permalink to this heading">#</a></h2>
<p>Same as normal Python programs, Legate programs can be run
using Jupyter Notebook. Currently we support single node execution with
multiple CPUs and GPUs, and plan to support multi-node execution in the future.
We leverage Legion’s Jupyter support, so you may want to refer to the
<a class="reference external" href="https://github.com/StanfordLegion/legion/blob/master/jupyter_notebook/README.md">relevant section in Legion’s README</a>.
To simplify the installation, we provide a script specifically for Legate libraries.</p>
<section id="installation-of-the-legate-ipython-kernel">
<h3>Installation of the Legate IPython Kernel<a class="headerlink" href="#installation-of-the-legate-ipython-kernel" title="Permalink to this heading">#</a></h3>
<p>Please install Legate, then run the following command to install a default
Jupyter kernel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">legate</span><span class="o">-</span><span class="n">jupyter</span>
</pre></div>
</div>
<p>If installation is successful, you will see some output like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Jupyter</span> <span class="n">kernel</span> <span class="n">spec</span> <span class="n">Legate_SM_GPU</span> <span class="p">(</span><span class="n">Legate_SM_GPU</span><span class="p">)</span> <span class="n">has</span> <span class="n">been</span> <span class="n">installed</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Legate_SM_GPU</span></code> is the default kernel name.</p>
</section>
<section id="running-with-jupyter-notebook">
<h3>Running with Jupyter Notebook<a class="headerlink" href="#running-with-jupyter-notebook" title="Permalink to this heading">#</a></h3>
<p>You will need to start a Jupyter server, then you can use a Jupyter notebook
from any browser. Please refer to the following two sections from the README of
the Legion Jupyter Notebook extension:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/StanfordLegion/legion/tree/master/jupyter_notebook#start-the-jupyter-notebook-server">Start the Jupyter Notebook server</a></p></li>
<li><p><a class="reference external" href="https://github.com/StanfordLegion/legion/tree/master/jupyter_notebook#use-the-jupyter-notebook-in-the-browser">Use the Jupyter Notebook in the browser</a></p></li>
</ul>
</section>
<section id="configuring-the-jupyter-notebook">
<h3>Configuring the Jupyter Notebook<a class="headerlink" href="#configuring-the-jupyter-notebook" title="Permalink to this heading">#</a></h3>
<p>The Legate Jupyter kernel is configured according to the command line arguments
provided at install time.  Standard <code class="docutils literal notranslate"><span class="pre">legate</span></code> options for Core, Memory, and
Mult-node configuration may be provided, as well as a name for the kernel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">legate</span><span class="o">-</span><span class="n">jupyter</span> <span class="o">--</span><span class="n">name</span> <span class="n">legate_cpus_2</span> <span class="o">--</span><span class="n">cpus</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Other configuration options can be seen by using the <code class="docutils literal notranslate"><span class="pre">--help</span></code> command line option.</p>
</section>
<section id="magic-command">
<h3>Magic Command<a class="headerlink" href="#magic-command" title="Permalink to this heading">#</a></h3>
<p>We provide a Jupyter magic command to display the IPython kernel configuration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">legate</span><span class="o">.</span><span class="n">jupyter</span>
<span class="o">%</span><span class="n">legate_info</span>
</pre></div>
</div>
<p>results in output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kernel</span> <span class="s1">&#39;Legate_SM_GPU&#39;</span> <span class="n">configured</span> <span class="k">for</span> <span class="mi">1</span> <span class="n">node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">Cores</span><span class="p">:</span>
  <span class="n">CPUs</span> <span class="n">to</span> <span class="n">use</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">:</span> <span class="mi">4</span>
  <span class="n">GPUs</span> <span class="n">to</span> <span class="n">use</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="n">OpenMP</span> <span class="n">groups</span> <span class="n">to</span> <span class="n">use</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="n">Threads</span> <span class="n">per</span> <span class="n">OpenMP</span> <span class="n">group</span> <span class="p">:</span> <span class="mi">4</span>
  <span class="n">Utility</span> <span class="n">processors</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">:</span> <span class="mi">2</span>

<span class="n">Memory</span><span class="p">:</span>
  <span class="n">DRAM</span> <span class="n">memory</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">(</span><span class="ow">in</span> <span class="n">MBs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">4000</span>
  <span class="n">DRAM</span> <span class="n">memory</span> <span class="n">per</span> <span class="n">NUMA</span> <span class="n">domain</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">(</span><span class="ow">in</span> <span class="n">MBs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="n">Framebuffer</span> <span class="n">memory</span> <span class="n">per</span> <span class="n">GPU</span> <span class="p">(</span><span class="ow">in</span> <span class="n">MBs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">4000</span>
  <span class="n">Zero</span><span class="o">-</span><span class="n">copy</span> <span class="n">memory</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">(</span><span class="ow">in</span> <span class="n">MBs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">32</span>
  <span class="n">Registered</span> <span class="n">CPU</span><span class="o">-</span><span class="n">side</span> <span class="n">pinned</span> <span class="n">memory</span> <span class="n">per</span> <span class="n">rank</span> <span class="p">(</span><span class="ow">in</span> <span class="n">MBs</span><span class="p">)</span> <span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
</section>
<section id="other-faqs">
<h2>Other FAQs<a class="headerlink" href="#other-faqs" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><em>Does Legate only work on NVIDIA hardware?</em>
No, Legate will run on any processor supported by Legion (e.g. x86, ARM, and
PowerPC CPUs), and any network supported by GASNet or UCX (e.g. Infiniband,
Cray, Omnipath, and (ROC-)Ethernet based interconnects).</p></li>
<li><p><em>What languages does the Legate Core API have bindings for?</em>
Currently the Legate Core bindings are only available in Python. Watch
this space for new language bindings soon or make a pull request to
contribute your own. Legion has a C API which should make it easy to
develop bindings in any language with a foreign function interface.</p></li>
<li><p><em>Do I have to build drop-in replacement libraries?</em>
No! While we’ve chosen to provide drop-in replacement libraries for
popular Python libraries to illustrate the benefits of Legate, you
are both welcomed and encouraged to develop your own libraries on top
of Legate. We promise that they will compose well with other existing
Legate libraries.</p></li>
<li><p><em>What other libraries are you planning to release for the Legate ecosystem?</em>
We’re still working on that. If you have thoughts about what is important
please let us know so that we can get a feel for where best to put our time.</p></li>
<li><p><em>Can I use Legate with other Legion libraries?</em>
Yes! If you’re willing to extract the Legion primitives from the <code class="docutils literal notranslate"><span class="pre">LegateStore</span></code>
objects you should be able to pass them into other Legion libraries such as
<a class="reference external" href="https://flexflow.ai/">FlexFlow</a>.</p></li>
<li><p><em>Does Legate interoperate with X?</em>
Yes, probably, but we don’t recommend it. Our motivation for building
Legate is to provide the bare minimum subset of functionality that
we believe is essential for building truly composable software that can still
run at scale. No other systems out there met our needs. Providing
interoperability with those other systems will destroy the very essence
of what Legate is and significantly dilute its benefits. All that being
said, Legion does provide some means of doing stop-the-world exchanges
with other runtime system running concurrently in the same processes.
If you are interested in pursuing this approach please open an issue
on the <a class="reference external" href="https://github.com/StanfordLegion/legion/issues">Legion github issue tracker</a>
as it will be almost entirely orthogonal to how you use Legate.</p></li>
</ul>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this heading">#</a></h2>
<p>See the discussion of contributing in <a class="reference internal" href="CONTRIBUTING.html"><span class="doc std std-doc">CONTRIBUTING.md</span></a>.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">#</a></h2>
<p>A complete list of available features can is provided in the <a class="reference external" href="https://nv-legate.github.io/legate.core/api.html">API
reference</a>.</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<p>We recommend starting by experimenting with at least one Legate application
library to test out performance and see how Legate works. If you are interested
in building your own Legate application library, we recommend that you
investigate our <a class="reference external" href="https://github.com/nv-legate/legate.hello">Legate Hello World application
library</a> that provides a small
example of how to get started developing your own drop-in replacement library
on top of Legion using the Legate Core library.</p>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Welcome to Legate Core’s documentation!</p>
      </div>
    </a>
    <a class="right-next"
       href="BUILD.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Basic build</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-legate">Why Legate?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-legate-core">What is the Legate Core?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-does-legate-work">How Does Legate Work?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-i-install-legate">How Do I Install Legate?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-i-use-legate">How Do I Use Legate?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distributed-launch">Distributed Launch</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-and-profiling">Debugging and Profiling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-legate-programs-with-jupyter-notebook">Running Legate programs with Jupyter Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-of-the-legate-ipython-kernel">Installation of the Legate IPython Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-with-jupyter-notebook">Running with Jupyter Notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-the-jupyter-notebook">Configuring the Jupyter Notebook</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#magic-command">Magic Command</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-faqs">Other FAQs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing">Contributing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/README.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2021-2022, NVIDIA.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>